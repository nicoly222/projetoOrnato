<script>
  // ================================
  // 1. PEGAR O ID DO PRODUTO NA URL
  // exemplo: produto.html?id=1
  // ================================
  const urlParams = new URLSearchParams(window.location.search);
  const productId = urlParams.get("id") || 1; // fallback para 1

  // ================================
  // 2. BUSCAR O PRODUTO NO BACKEND
  // ================================
  async function carregarProduto() {
    try {
      const response = await fetch(`http://localhost:8080/api/produtos/${productId}`);
      if (!response.ok) throw new Error("Produto n√£o encontrado");

      const produto = await response.json();

      document.querySelector(".produto-info h1").textContent = produto.name;
      document.querySelector(".preco").textContent = 
        "R$ " + Number(produto.price).toFixed(2).replace(".", ",");

      if (produto.imageUrl) {
        document.querySelector(".principal").src = produto.imageUrl;
      }

      // Como seu site agora s√≥ tem uma cor e tamanho √∫nico:
      document.querySelector(".cores").style.display = "none";
      document.querySelector(".tamanhos").style.display = "none";

    } catch (err) {
      console.error("Erro ao carregar produto:", err);
    }
  }

  carregarProduto();


  // ==============================================
  // 3. CRIAR O CARRINHO (se ainda n√£o existir)
  // ==============================================
  async function obterOuCriarCarrinho() {
    let cartId = localStorage.getItem("cartId");

    if (!cartId) {
      const response = await fetch("http://localhost:8080/api/carrinho", {
        method: "POST"
      });
      const novoCarrinho = await response.json();
      cartId = novoCarrinho.id;
      localStorage.setItem("cartId", cartId);
    }

    return cartId;
  }

  // ==============================================
  // 4. ADICIONAR AO CARRINHO
  // ==============================================
  async function adicionarAoCarrinho() {
    const cartId = await obterOuCriarCarrinho();

    await fetch(`http://localhost:8080/api/carrinho/${cartId}/items`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        productId: Number(productId),
        quantity: 1
      })
    });

    mostrarMensagem("Produto adicionado ao carrinho! üõçÔ∏è");
  }

  // ==============================================
  // 5. POPUP DE CONFIRMA√á√ÉO
  // ==============================================
  function mostrarMensagem(texto) {
    const msg = document.createElement("div");
    msg.textContent = texto;
    msg.style.position = "fixed";
    msg.style.top = "20px";
    msg.style.right = "20px";
    msg.style.padding = "12px 18px";
    msg.style.backgroundColor = "#b89a67";
    msg.style.color = "white";
    msg.style.borderRadius = "6px";
    msg.style.boxShadow = "0 3px 8px rgba(0,0,0,0.2)";
    msg.style.zIndex = "9999";
    msg.style.fontFamily = "Poppins";

    document.body.appendChild(msg);

    setTimeout(() => {
      msg.remove();
    }, 2000);
  }

  // ==============================================
  // 6. LIGAR BOT√ÉO "COMPRAR" AO JS
  // ==============================================
  document.querySelector(".btn-comprar")
    .addEventListener("click", adicionarAoCarrinho);
</script>
